<html>

<head>

</head>

<body>
    <video id="vid" src="" controls></video>
    <script>
        var x = new XMLHttpRequest();
        x.open("POST", "https://corsok.herokuapp.com/https://ok.ru/dk?cmd=videoPlayerMetadata&mid=302608026311");
        //atach function to status change event
        x.onreadystatechange = function () {
            if (x.readyState == 4 && x.status == 200) { //on completed request run this...
                content = JSON.parse(x.responseText); //x.responseText => response body
                videos = content.videos;
                security = content.security.url;
                var x2 = new XMLHttpRequest();
		x2.withCredentials=true;
                x2.open("POST", "https://corsok.herokuapp.com/" + security);
                x2.withCredentials=true;
                x2.onreadystatechange = function () {
                    if (x2.readyState == 4 && x2.status == 200) {
                        content2 = JSON.parse(x2.responseText);
                        console.log(content2.vtkn);
                        document.getElementById("vid").src=videos[0].url+"&vdsig="+content2.vtkn;
                    }
                }
                x2.send();//send second xhr request
                console.log(content);
            }
        }
        x.send();//send first xhr request

      document.cookie = "vdtkn=p; Path=/; domain=.mycdn.com; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
     document.cookie = "tstc=p; Path=/; domain=.mycdn.com; expires=Thu, 01 Jan 1970 00:00:01 GMT;";
    </script>
</body>

</html>
